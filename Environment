#!/bin/bash

# COLORS
R="\e[31m"; G="\e[32m"; Y="\e[33m"; B="\e[34m"; C="\e[36m"; M="\e[35m"; W="\e[37m"; N="\e[0m"

# NEW UI STYLE FUNCTIONS
print_box() {
    local text="$1"
    local color="$2"
    local width=50
    local padding=$(( (width - ${#text} - 2) / 2 ))
    
    echo -e "${color}â”Œ$(printf 'â”€%.0s' $(seq 1 $((width-2))))â”${N}"
    printf "${color}â”‚%*s%s%*sâ”‚${N}\n" $padding "" "$text" $((padding - ((${#text} % 2) ? 1 : 0))) ""
    echo -e "${color}â””$(printf 'â”€%.0s' $(seq 1 $((width-2))))â”˜${N}"
}

print_header() {
    clear
    echo -e "\n${C}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${N}"
    echo -e "${C}â•‘${W}                  S D G A M E R                 ${C}â•‘${N}"
    echo -e "${C}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
}

print_option() {
    local num="$1"
    local text="$2"
    local color="$3"
    
    echo -e "  ${color}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${N}"
    echo -e "  ${color}â”‚${W}  [$num]  $text$(printf '%*s' $((31 - ${#text} - 6)))${color}â”‚${N}"
    echo -e "  ${color}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${N}\n"
}

print_status() {
    local text="$1"
    local color="$2"
    echo -e "\n${color}â–¶â–¶ ${text}${N}\n"
}

# MAIN MENU LOOP
while true; do
    print_header
    
    print_option "1" "RDX Tool" "$G"
    print_option "2" "ğ—¥ğ˜‚ğ—» ğ˜ƒğ—º 1 Kvm" "$Y"
    print_option "3" "ğ—¥ğ˜‚ğ—» ğ˜ƒğ—º 2 No Kvm" "$B"
    print_option "4" "Proxmox" "$B"
    print_option "5" "Exit" "$R"

    
    echo -e "${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}"
    echo -ne "${W}Select Option â†’ ${N}"
    read -p "" op
    
    case $op in
    
    # =========================================================
    # (1) RDX TOOL - ENHANCED
    # =========================================================
    1)
        clear
        print_status "ğŸ”§ Running RDX Tool Setup..." "$Y"
        echo -e "${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
        
        echo -e "${C}ğŸ§¹ Cleaning up old files...${N}"
        cd
        rm -rf myapp
        rm -rf flutter
        
        cd vm
        
        if [ ! -d ".idx" ]; then
            echo -e "${G}ğŸ“ Creating .idx directory...${N}"
            mkdir .idx
            cd .idx
            
            echo -e "${C}ğŸ“ Creating dev.nix configuration...${N}"
            cat <<EOF > dev.nix
{ pkgs, ... }: {
  channel = "stable-24.05";

  packages = with pkgs; [
    unzip
    openssh
    git
    qemu_kvm
    sudo
    cdrkit
    cloud-utils
    qemu
  ];

  env = {
    EDITOR = "nano";
  };

  idx = {
    extensions = [
      "Dart-Code.flutter"
      "Dart-Code.dart-code"
    ];

    workspace = {
      onCreate = { };
      onStart = { };
    };

    previews = {
      enable = false;
    };
  };
}
EOF
            
            echo -e "\n${G}âœ… RDX Tool setup complete!${N}"
            echo -e "${W}â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${N}"
            echo -e "${W}â”‚ ${G}Status${W}: ${Y}Ready to use${W}                 â”‚${N}"
            echo -e "${W}â”‚ ${G}Location${W}: ${Y}~/vps123/.idx${W}              â”‚${N}"
            echo -e "${W}â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${N}"
        else
            echo -e "${Y}âš  Directory .idx already exists â€” skipping.${N}"
        fi
        
        echo -e "\n${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}"
        read -p "â†© Press Enter..."
        ;;
    
    # =========================================================
    # (2) ğ—¥ğ˜‚ğ—» ğ˜ƒğ—ºğŸ­ Kvm â€” ENHANCED
    # =========================================================
    2)
        clear
        print_status "ğŸŒ Starting SDGAMER VM From GitHub Script..." "$B"
        echo -e "${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
        
        echo -e "${C}ğŸ“¡ Fetching script from GitHub...${N}"
        bash <(curl -s https://raw.githubusercontent.com/sdgamer8263-sketch/SDGAMER/refs/heads/main/srv/vm/vm.sh)
        
        echo -e "\n${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}"
        read -p "â†© Press Enter..."
        ;;

    # =========================================================
    # (3) ğ—¥ğ˜‚ğ—» ğ˜ƒğ—ºğŸ® No kvm  â€” ENHANCED
    # =========================================================
    3)
        clear
        print_status "ğŸŒ Starting vm 2 From GitHub Script..." "$B"
        echo -e "${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
        
        echo -e "${C}ğŸ“¡ Fetching script from GitHub...${N}"

        bash <(curl -s https://raw.githubusercontent.com/sdgamer8263-sketch/SDGAMER/refs/heads/main/srv/vm/dd.sh)
        bash <(curl -s https://raw.githubusercontent.com/sdgamer8263-sketch/SDGAMER/refs/heads/main/srv/vm/vm2.sh)
        
        echo -e "\n${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}"
        read -p "â†© Press Enter..."
        ;;

    # =========================================================
    # (4) poxmox setup  â€” ENHANCED
    # =========================================================
    4)
        clear
        print_status "ğŸŒ Starting vm 2 From GitHub Script..." "$B"
        echo -e "${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
        
        echo -e "${C}ğŸ“¡ Fetching script from GitHub...${N}"

        bash <(curl -s https://raw.githubusercontent.com/sdgamer8263-sketch/SDGAMER/refs/heads/main/srv/vm/proxmox.sh)
        
        echo -e "\n${M}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}"
        read -p "â†© Press Enter..."
        ;;  
    # =========================================================
    # EXIT - ENHANCED
    # =========================================================
    5)
        clear
        echo -e "\n${C}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${N}"
        echo -e "${C}â•‘${R}                 E X I T I N G                  ${C}â•‘${N}"
        echo -e "${C}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${N}\n"
        echo -e "${Y}ğŸ‘‹ Thank you for using the SDGAMER Menu!${N}\n"
        exit 0
        ;;
    
    *)
        echo -e "\n${R}âŒ Invalid Option! Please try again.${N}"
        sleep 1
        ;;
    esac
done
